# DirectApp - Production Environment Configuration
# This file is used as a template for Dokploy deployment
# Copy values to Dokploy UI environment variables section

# ========================================
# AUTOBASE POSTGRESQL CLUSTER
# ========================================
# Autobase is a Dokploy service on Hetzner VPS (157.180.125.91)
# Service name: autobase
# Primary: 10.0.1.6:6432 (internal IP in dokploy-network)
# Replica: 10.0.1.7:6432 (internal IP, available for read scaling)
#
# For production: Use internal IPs in dokploy-network

DB_HOST=10.0.1.6
DB_PORT=6432
DB_DATABASE=directapp_production
DB_USER=postgres
DB_PASSWORD=v5Kry76iPdEFUXOfxUlnswH77m68fAvI

# ========================================
# DIRECTUS SECURITY KEYS
# ========================================
# Generate UNIQUE keys for production (different from dev and staging):
#   openssl rand -base64 32  # KEY
#   openssl rand -base64 64  # SECRET
#
# CRITICAL: NEVER use dev or staging keys in production!
# CRITICAL: Use strong, unique keys and store securely!

DIRECTUS_KEY=<generate-with-openssl-rand-base64-32-UNIQUE>
DIRECTUS_SECRET=<generate-with-openssl-rand-base64-64-UNIQUE>

# ========================================
# DIRECTUS ADMIN ACCOUNT
# ========================================
# Used only on first startup to bootstrap admin user
# CRITICAL: Remove these variables after first deployment!
# CRITICAL: Use a STRONG password (16+ characters, mixed case, numbers, symbols)

ADMIN_EMAIL=admin@gapp.coms.no
ADMIN_PASSWORD=<set-VERY-strong-password-here>

# ========================================
# APPLICATION URL
# ========================================

PUBLIC_URL=https://gapp.coms.no
CORS_ORIGIN=https://gapp.coms.no
COOKIE_DOMAIN=.coms.no

# ========================================
# EMAIL (Resend)
# ========================================
# Use production Resend account

EMAIL_FROM=DirectApp <noreply@coms.no>
RESEND_API_KEY=<your-production-resend-api-key>

# ========================================
# STORAGE (S3-compatible)
# ========================================
# Use production S3 bucket with proper backup and retention policies

# Option 1: AWS S3
STORAGE_LOCATIONS=s3
S3_ACCESS_KEY=<your-production-s3-access-key>
S3_SECRET_KEY=<your-production-s3-secret-key>
S3_BUCKET=directapp-production
S3_REGION=eu-north-1

# Option 2: Cloudflare R2
# STORAGE_LOCATIONS=s3
# S3_ENDPOINT=https://<account-id>.r2.cloudflarestorage.com
# S3_ACCESS_KEY=<r2-production-access-key>
# S3_SECRET_KEY=<r2-production-secret-key>
# S3_BUCKET=directapp-production
# S3_REGION=auto

# ========================================
# EXTERNAL API TOKENS
# ========================================

# Norwegian Vehicle Registry API (Statens Vegvesen)
# Use production token with appropriate rate limits
STATENS_VEGVESEN_TOKEN=<your-production-token>

# ========================================
# MONITORING (REQUIRED for production)
# ========================================

# Sentry for error tracking - REQUIRED
SENTRY_DSN=<your-production-sentry-dsn>

# ========================================
# SECURITY (Production hardening)
# ========================================

# Rate limiting enabled
RATE_LIMITER_ENABLED=true
RATE_LIMITER_POINTS=25
RATE_LIMITER_DURATION=1

# Session security
ACCESS_TOKEN_TTL=15m
REFRESH_TOKEN_TTL=7d
REFRESH_TOKEN_COOKIE_SECURE=true
REFRESH_TOKEN_COOKIE_SAME_SITE=lax

# ========================================
# PRE-DEPLOYMENT CHECKLIST
# ========================================
#
# [ ] Database directapp_production created on Autobase
# [ ] Generated unique DIRECTUS_KEY and DIRECTUS_SECRET
# [ ] Set strong ADMIN_PASSWORD (16+ characters)
# [ ] S3 bucket created with backup policy
# [ ] Resend production API key obtained
# [ ] Statens Vegvesen production token obtained
# [ ] Sentry production project created
# [ ] Staging environment fully tested
# [ ] Backup strategy confirmed
# [ ] Monitoring dashboards configured
# [ ] Team trained on production procedures
#
# ========================================
# DEPLOYMENT NOTES
# ========================================
#
# Dokploy Deployment Steps:
# 1. Complete pre-deployment checklist above
# 2. Create service in Dokploy: directapp-production
# 3. Upload docker-compose.production.yml
# 4. Copy these environment variables to Dokploy UI
# 5. Deploy service
# 6. Verify health: https://gapp.coms.no/server/health
# 7. Log in and change admin password IMMEDIATELY
# 8. Create regular user accounts with appropriate roles
# 9. Remove ADMIN_EMAIL and ADMIN_PASSWORD from Dokploy
# 10. Redeploy service
# 11. Set up monitoring dashboards
# 12. Test all critical workflows
#
# See DOKPLOY_DEPLOYMENT_GUIDE.md for complete deployment instructions
#
# ========================================
# SECURITY REMINDERS
# ========================================
#
# - NEVER commit .env.production to git
# - Use different keys for staging and production
# - Enable 2FA for admin users
# - Regularly rotate security keys
# - Monitor Sentry for errors
# - Review access logs regularly
# - Keep database backups tested
# - Document rollback procedures
